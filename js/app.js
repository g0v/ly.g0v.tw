function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function matchMotions(t,e){var n,r,a,i;for(n=moment(e.date).format("YYYY-MM-DD"),r=0,a=t.length;a>r;++r)if(i=t[r],i.date===n&&i.description==="決定："+e.resolution.replace(/\(\S+\s+\S+\)/,""))return void(i.links=e.links);return t.push({date:n,description:e.resolution,links:e.links})}function buildSteps(t){var e,n,r,a,i,o,s,l,c,u;for(e=[{name:"proposal",sub:!1,description:"提案",status:{step:"passed",state:"not-yet",icon:""},detail:[]},{name:"first-reading",sub:!1,description:"一讀",status:{step:"not-yet",state:"not-yet",icon:""},detail:[]},{name:"committee",sub:!1,description:"委員會",status:{step:"not-yet",state:"not-yet",icon:""},detail:[]},{name:"second-reading",sub:!1,description:"二讀",status:{step:"not-yet not-implemented no-hover",state:"not-yet",icon:""},detail:[]},{name:"third-reading",sub:!1,description:"三讀",status:{step:"not-yet not-implemented no-hover",state:"not-yet",icon:"check"},date:"",detail:[]},{name:"announced",sub:!1,description:"頒佈",status:{step:"not-yet not-implemented no-hover",state:"not-yet",icon:"check"},date:"",detail:[]},{name:"implemented",sub:!1,description:"生效",status:{step:"not-yet not-implemented no-hover",state:"hidden",icon:""},date:"",detail:[]}],n=0,r=t.length;r>n;++n)switch(a=n,i=t[n],0===a&&(e[0].date=i.dates[0].date),o=[i.status],!1){case"prioritized"!==o[0]:s={name:"proposal",description:i.resolution,status:{step:"passed",state:"passed",icon:"star"},date:i.dates[0].date},l=e[0].status,"not-yet"===l.state&&(l.state="passed"),l.icon||(l.icon="check"),e[1].status=s.status,e[1].detail.push(s),e[2].status={icon:"star",state:"passed"};break;case"rejected"!==o[0]:s={name:"proposal",description:i.resolution,status:{step:"returned",state:"returned",icon:"exclamation"},date:i.dates[0].date},e[0].detail.push(s),c=e[0].status,c.icon="exclamation",c.state="returned";break;case"committee"!==o[0]:s={name:"scheduled",description:i.resolution,status:{step:"passed",state:"passed",icon:"check"},date:i.dates[0].date},e[1].date=i.dates[0].date,e[1].status=s.status,e[1].detail.push(s),u=e[0].status,"not-yet"===u.state&&(u.state="passed"),u.icon||(u.icon="check"),e[0].detail.push(s)}return e}function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function deepEq$(t,e,n){function r(t,e,i){var l,c,u,d,f,p,m,g;if(null==t||null==e)return t===e;if(t.__placeholder__||e.__placeholder__)return!0;if(t===e)return 0!==t||1/t==1/e;if(l=a.call(t),a.call(e)!=l)return!1;switch(l){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(c=i.length;c--;)if(i[c]==t)return!0;if(i.push(t),u=0,d=!0,"[object Array]"==l){if(f=t.length,p=e.length,s){switch(n){case"===":d=f===p;break;case"<==":d=p>=f;break;case"<<=":d=p>f}u=f,s=!1}else d=f===p,u=f;if(d)for(;u--&&(d=u in t==u in e&&r(t[u],e[u],i)););}else{if("constructor"in t!="constructor"in e||t.constructor!=e.constructor)return!1;for(m in t)if(o(t,m)&&(u++,!(d=o(e,m)&&r(t[m],e[m],i))))break;if(d){g=0;for(m in e)o(e,m)&&++g;s?d="<<="===n?g>u:"<=="===n?g>=u:u===g:(s=!1,d=u===g)}}return i.pop(),d}var a={}.toString,i={}.hasOwnProperty,o=function(t,e){return i.call(t,e)},s=!0;return r(t,e,[])}function curry$(t,e){var n,r=function(a){return t.length>1?function(){var i=a?a.concat():[];return n=e?n||this:this,i.push.apply(i,arguments)<t.length&&arguments.length?r.call(n,i):t.apply(n,i)}:t};return r()}function deepEq$(t,e,n){function r(t,e,i){var l,c,u,d,f,p,m,g;if(null==t||null==e)return t===e;if(t.__placeholder__||e.__placeholder__)return!0;if(t===e)return 0!==t||1/t==1/e;if(l=a.call(t),a.call(e)!=l)return!1;switch(l){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(c=i.length;c--;)if(i[c]==t)return!0;if(i.push(t),u=0,d=!0,"[object Array]"==l){if(f=t.length,p=e.length,s){switch(n){case"===":d=f===p;break;case"<==":d=p>=f;break;case"<<=":d=p>f}u=f,s=!1}else d=f===p,u=f;if(d)for(;u--&&(d=u in t==u in e&&r(t[u],e[u],i)););}else{if("constructor"in t!="constructor"in e||t.constructor!=e.constructor)return!1;for(m in t)if(o(t,m)&&(u++,!(d=o(e,m)&&r(t[m],e[m],i))))break;if(d){g=0;for(m in e)o(e,m)&&++g;s?d="<<="===n?g>u:"<=="===n?g>=u:u===g:(s=!1,d=u===g)}}return i.pop(),d}var a={}.toString,i={}.hasOwnProperty,o=function(t,e){return i.call(t,e)},s=!0;return r(t,e,[])}function deepEq$(t,e,n){function r(t,e,i){var l,c,u,d,f,p,m,g;if(null==t||null==e)return t===e;if(t.__placeholder__||e.__placeholder__)return!0;if(t===e)return 0!==t||1/t==1/e;if(l=a.call(t),a.call(e)!=l)return!1;switch(l){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(c=i.length;c--;)if(i[c]==t)return!0;if(i.push(t),u=0,d=!0,"[object Array]"==l){if(f=t.length,p=e.length,s){switch(n){case"===":d=f===p;break;case"<==":d=p>=f;break;case"<<=":d=p>f}u=f,s=!1}else d=f===p,u=f;if(d)for(;u--&&(d=u in t==u in e&&r(t[u],e[u],i)););}else{if("constructor"in t!="constructor"in e||t.constructor!=e.constructor)return!1;for(m in t)if(o(t,m)&&(u++,!(d=o(e,m)&&r(t[m],e[m],i))))break;if(d){g=0;for(m in e)o(e,m)&&++g;s?d="<<="===n?g>u:"<=="===n?g>=u:u===g:(s=!1,d=u===g)}}return i.pop(),d}var a={}.toString,i={}.hasOwnProperty,o=function(t,e){return i.call(t,e)},s=!0;return r(t,e,[])}function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function curry$(t,e){var n,r=function(a){return t.length>1?function(){var i=a?a.concat():[];return n=e?n||this:this,i.push.apply(i,arguments)<t.length&&arguments.length?r.call(n,i):t.apply(n,i)}:t};return r()}function getVideosByCut(t,e,n){return t.get("sittings/"+e+"/videos").success(function(t){function e(t){var e;return+d<(e=+moment(t.time))&&f>=e}var r,a,i,o,s,l,c,u,d,f,p,m,g,h;for(a=[],i=0,o=t.length;o>i;++i)s=t[i],"whole"===s.firm&&a.push((s.first_frame=moment(null!=(l=s.first_frame_timestamp)?l:s.time),s));for(r=a,a=[],i=0,o=t.length;o>i;++i)s=t[i],"whole"!==s.firm&&a.push({time:s.time,mly:replace$.call(s.speaker,/\s*委員/,""),length:s.length,thumb:s.thumb});for(c=a,i=0,o=r.length;o>i;++i){for(u=r[i],d=u.first_frame,f=d+1e3*u.length,p=c.filter(e),m=0,g=p.length;g>m;++m)h=p[m],h.offset=moment(h.time)-d;u.speakers=p}return n(r)})}function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},n={},r=function(t,e){return{}.hasOwnProperty.call(t,e)},a=function(t,e){var n,r,a=[];n=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var i=0,o=n.length;o>i;i++)r=n[i],".."===r?a.pop():"."!==r&&""!==r&&a.push(r);return a.join("/")},i=function(t){return t.split("/").slice(0,-1).join("/")},o=function(e){return function(n){var r=i(e),o=a(r,n);return t.require(o,e)}},s=function(t,e){var r={id:t,exports:{}};return n[t]=r,e(r.exports,o(t),r),r.exports},l=function(t,i){var o=a(t,".");if(null==i&&(i="/"),r(n,o))return n[o].exports;if(r(e,o))return s(o,e[o]);var l=a(o,"./index");if(r(n,l))return n[l].exports;if(r(e,l))return s(l,e[l]);throw new Error('Cannot find module "'+t+'" from "'+i+'"')},c=function(t,n){if("object"==typeof t)for(var a in t)r(t,a)&&(e[a]=t[a]);else e[t]=n},u=function(){var t=[];for(var n in e)r(e,n)&&t.push(n);return t};t.require=l,t.require.define=c,t.require.register=c,t.require.list=u,t.require.brunch=!0}}(),angular.module("ly.g0v.tw",["ngGrid","app.controllers","ly.g0v.tw.controllers","app.directives","app.filters","app.services","app.templates","ui.state","utils","monospaced.qrcode"]).config(["$stateProvider","$urlRouterProvider","$locationProvider"].concat(function(t,e,n){return t.state("motions",{url:"/motions",templateUrl:"app/partials/motions.jade",controller:"LYMotions"}).state("motions.sitting",{url:"/{session}/{sitting}"}).state("sittings-new",{url:"/sittings-new/{sittingId}",templateUrl:"app/partials/sittings-new.jade",resolve:{_init:["LYService"].concat(function(t){return t.init()})},controller:"LYSittingsNew"}).state("bills",{url:"/bills/{billId}",templateUrl:"app/partials/bills.jade",resolve:{_init:["LYService"].concat(function(t){return t.init()})},controller:"LYBills"}).state("bills.compare",{url:"/compare/{otherBills}"}).state("calendar",{url:"/calendar",templateUrl:"app/partials/calendar.jade",resolve:{_init:["LYService"].concat(function(t){return t.init()})},controller:"LYCalendar"}).state("calendar.period",{url:"/{period}"}).state("sittings",{url:"/sittings",templateUrl:"app/partials/sittings.jade",controller:"LYSittings",resolve:{_init:["LYService"].concat(function(t){return t.init()})}}).state("sittings.detail",{url:"/{sitting}"}).state("sittings.detail.video",{url:"/video"}).state("debates",{url:"/debates",templateUrl:"app/partials/debates.jade",resolve:{_init:["LYService"].concat(function(t){return t.init()})}}).state("search",{url:"/search",templateUrl:"app/partials/search.jade",controller:"LYSearch"}).state("search.target",{url:"/{keyword}"}).state("about",{url:"/about",templateUrl:"app/partials/about.jade",controller:"About"}),e.otherwise("/calendar"),n.html5Mode(!0)})).run(["$rootScope","$state","$stateParams","$location","$anchorScroll"].concat(function(t,e,n,r){return t.$state=e,t.$stateParam=n,t.go=function(t){return r.path(t)},t.config_build=window.global.config.BUILD,t.$on("$stateChangeSuccess",function(t,e){var n;return n=e.name,"undefined"!=typeof window&&null!==window?"function"==typeof window.ga?window.ga("send","pageview",{page:r.$$url,title:n}):void 0:void 0}),window.onYouTubeIframeAPIReady=function(){return t.$broadcast("youtube-ready")}}));var committees,renderCommittee;committees={IAD:"內政",FND:"外交及國防",ECO:"經濟",FIN:"財政",EDU:"教育及文化",TRA:"交通",JUD:"司法及法制",SWE:"社會福利及衛生環境",PRO:"程序"},renderCommittee=function(t){var e,n,r,a,i;if(null==t)return"院會";if("null"===t)return"院會";for($.isArray(t)||(t=[t]),n=[],r=0,a=t.length;a>r;++r)i=t[r],n.push('<img class="avatar small" src="http://avatars.io/50a65bb26e293122b0000073/committee-'+i+'?size=small" alt="'+committees[i]+'">'+committees[i]);return e=n,e.join("")},angular.module("app.controllers",["app.controllers.calendar","app.controllers.sittings","app.controllers.sittings-new","app.controllers.bills","app.controllers.search","ng"]).run(["$rootScope"].concat(function(t){return t.committees=committees})).controller({AppCtrl:["$scope","$location","$rootScope","$sce"].concat(function(t,e){return t.$location=e,t.$watch("$location.path()",function(e){return e||(e="/"),t.activeNavId=e,t}),t.getClass=function(e){return t.activeNavId.substring(0,e.length===e)?"active":""}})}).filter("committee",["$sce"].concat(function(t){return function(e){return t.trustAsHtml(renderCommittee(e))}})).controller({SearchFormCtrl:["$scope","$state"].concat(function(t,e){return t.submitSearch=function(){return e.transitionTo("search.target",{keyword:t.searchKeyword}),t.searchKeyword=""}})}).controller({About:["$rootScope","$http"].concat(function(t){return t.activeTab="about"})}).controller({LYMotions:["$rootScope","$scope","$state","LYService"].concat(function(t,e,n,r){return t.activeTab="motions",e.session="8-2",e.$on("data",function(t,n){return e.$apply(function(){return e.data=n})}),e.$watch("$state.params.sitting",function(){var t;return(t=n.params.sitting)?e.$watch("data",function(n){return n?(e.sitting=+t,e.setType("announcement"),e.setStatus(null)):void 0}):void(e.sitting=null)}),e.$on("show",function(t,r,a,i){return e.$apply(function(){return n.transitionTo("motions.sitting",{session:e.session,sitting:r}),e.sitting=r,e.status=i,e.setType(a),e.setStatus(i)})}),import$(e,{allTypes:[{key:"announcement",value:"報告事項"},{key:"discussion",value:"討論事項"},{key:"exmotion",value:"臨時提案"}],setType:function(t){var n,a,i,o,s,l,c,u,d,f,p;for(a=function(){var t,r,a,i=[];for(t=0,a=(r=e.data).length;a>t;++t)n=r[t],n.meeting.sitting===e.sitting&&i.push(n);return i}()[0],i=a[t],o=[{key:"all",value:"全部"}].concat(function(){function t(){var t,e,n,r,a={};for(t=0,n=(e=i).length;n>t;++t)l=e[t],a[null!=(r=l.status)?r:"unknown"]=!0;return a}var n=[];for(s in t())n.push({key:s,value:e.statusName(s)});return n}()),in$(e.status,o.map(function(t){return t.key}))||(e.status=""),c=0,u=i.length;u>c;++c)l=i[c],null==l.avatars&&(d=null!=(f=l.proposer)?f.match(/委員(.*?)(、|等)/):void 0)&&(p=r.resolveParty(d[1]),l.avatars=[{party:p,name:d[1],avatar:CryptoJS.MD5("MLY/"+d[1]).toString()}]);return e.type=t,e.entries=i,e.allStatus=o,e},setStatus:function(t){return"all"===t&&(t=""),"unknown"===t&&(t=""),e.status=t},statusName:function(t){var e,n;return e={unknown:"未知",other:"其他",passed:"通過",consultation:"協商",retrected:"撤回",unhandled:"未處理",ey:"請行政院研處",prioritized:"逕付二讀",committee:"交委員會",rejected:"退回",accepted:"查照"},null!=(n=e[t])?n:t}}),window.loadMotions(e)})});var buildAvatar,replace$="".replace,toString$={}.toString;buildAvatar=function(t,e,n,r,a){var i,o,s,l,c,u,d,f,p,m;return i=n.w,o=n.h,s=n.x,l=n.y,c=n.margin,u=1e3*((d=e.time)?moment(d).unix():-28800),f=d3.svg.axis().scale(s).orient("bottom").tickFormat(function(t){return moment((t+u/1e3)%86400*1e3).format("HH:mm:ss")}),p=d3.select(t.children()[0]).attr("width",i).attr("height",o).on("click",function(){var t;return t=s.invert(d3.mouse(this)[0]-c.left),$(p).find(".location-marker").attr("transform","translate("+t+" "+c.top+")"),e.cb(t)}).append("g").attr("transform","translate("+c.left+" "+c.top+")"),p.append("g").attr("class","x axis").attr("transform","translate(0,"+(o-c.bottom)+")").call(f),p.append("text").attr("class","x-legend").text(function(){return moment(e.time).format("YYYY/MM/DD")}).attr("x",function(){return(i+c.left-c.right)/2}).attr("y",function(){return o-c.bottom}).attr("dy",30).attr("stroke","black").attr("text-anchor","middle"),p.append("path").attr("class","location-marker").attr("d","M0 0L0,"+(o-c.bottom-c.top)).attr("stroke","#f00").attr("stroke-width","2px").attr("transform",function(){return"translate("+s(e.current)+" 0)"}),m=p.selectAll("g.avatar").data(e.speakers).enter().append("g"),m.each(function(t){return t.color=a.resolvePartyColor(t.mly)}),m.attr("class","avatar"),m.attr("transform",function(t){return"translate("+s(t.offset/1e3)+" 0)"}),m.on("mouseover",function(e){var n,a,i;return n=$("#avatar-tooltip"),n.show(),a=$(this).offset(),a.left-=n.outerWidth()/2,a.top=t.offset().top-n.outerHeight()-5,$("#avatar-tooltip").offset(a),i=CryptoJS.MD5("MLY/"+e.mly).toString(),n.find("img").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAQAICRAEAOw=="),setTimeout(function(){return n.find("img").attr("src","http://avatars.io/50a65bb26e293122b0000073/"+i+"?size=medium")},0),n.find(".name").text(e.mly),n.find("a.btn").on("click",function(){return r.model.cb(e.offset/1e3),$("#avatar-tooltip").hide()})}),m.append("rect").attr("width",function(t){var e;return(e=s(t.length))<12?12:e-1}).attr("height",12).style("stroke-width","1px").style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}).style("fill-opacity","0.5"),m.append("rect").attr("width",function(t){var e;return(e=s(t.length))<12?12:e-1}).attr("height",function(){return o-12-c.bottom}).attr("transform","translate(0 12)").style("stroke-width","1px").style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}).style("fill-opacity","0.2"),m.append("image").attr("class","avatar small").attr("transform","translate(1 1)").attr("width",10).attr("height",10).attr("xlink:href",function(t){var e;return e=CryptoJS.MD5("MLY/"+t.mly).toString(),"http://avatars.io/50a65bb26e293122b0000073/"+e+"?size=small"}).attr("alt",function(t){return t.speaker}),m},angular.module("app.directives",["app.services"]).directive("ngxResize",["$window"].concat(function(t){return function(e){return e.width=t.innerWidth,e.height=t.innerHeight,angular.element(t).bind("resize",function(){return e.$apply(function(){return e.width=t.innerWidth,e.height=t.innerHeight})})}})).directive("ngWaveform",["$compile","LYService"].concat(function(t,e){return{restrict:"E",replace:!0,template:"<div class='wav-group'><svg></svg></div>",scope:{model:"=ngModel"},link:function(t,n,r){var a,i,o,s,l,c,u,d,f,p,m,g;a={top:0,left:30,right:30,bottom:50},i=~~r.width||n.parent().width()-a.left-a.right,o=~~r.height||n.parent().height()-a.top-a.bottom,s=r.innercolor||"#000",l=r.outercolor||"#fff",c=[n.width(),n.height(),null,null],u=c[0],d=c[1],f=c[2],p=c[3],m=g=new Waveform({container:n[0],width:i,height:o,innerColor:s,outerColor:l}),m.canvas.style.marginLeft=a.left+"px",t.$watch("model.current",function(t){return n.find(".location-marker").attr("transform","translate("+("function"==typeof f?f(t):void 0)+" "+a.top+")")}),t.$watch("model",function(r){r&&(f=d3.scale.linear().range([0,u-a.left-a.right]).domain([0,r.wave.length]),p=d3.scale.linear().range([d,0]).domain([0,d3.max(r.wave)]),buildAvatar(n,r,{w:u,h:d,x:f,y:p,margin:a},t,e),r&&g.update({data:r.wave}))})}}})).directive("whenScrolled",function(){return function(t,e,n){var r;return r=e[0],e.bind("scroll",function(){return r.scrollTop+r.offsetHeight>=r.scrollHeight?t.$apply(n.whenScrolled):void 0})}}).directive("detectVisible",["$window","$document"].concat(function(t){return function(e,n,r){var a;if(r.detectVisible)return a=n[0],angular.element(t).bind("scroll",function(){return e.stopDetect?void 0:t.scrollY<a.offsetTop&&t.scrollY+t.innerHeight>a.offsetTop?e.$apply(r.detectVisible):void 0})}})).directive("autoComplete",["$timeout","$state","LYModel","LYLaws"].concat(function(t,e,n,r){return function(n,a){var i,o,s;return i=a.parent().next(),o={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},n.currentIndex=-1,s=7,a.on("keydown",function(r){var l,c,u;if(l=r.keyCode,c=n.currentIndex,i.children().size()>0)if(l===o.enter){if(c>=0)return r.preventDefault(),n.searchKeyword=i.children().eq(c).text(),t(function(){return e.transitionTo("search.target",{keyword:n.searchKeyword}),n.searchKeyword="",a.blur(),n.currentIndex=-1},500)}else{if(l===o.upArrow)return i.children().removeClass("active"),u=0>c-1?c:c-1,i.children().eq(u).addClass("active"),n.currentIndex=u,r.preventDefault();if(l===o.downArrow)return i.children().removeClass("active"),u=c+1>=s?c:c+1,i.children().eq(u).addClass("active"),n.currentIndex=u,r.preventDefault()}}),n.$watch("searchKeyword",function(t){return t?r.get(t,function(t){function e(){return n.searchKeyword="",a.blur()}var r,o,s,l,c;for(i.html(""),r=0,o=t.length;o>r;++r)s=t[r],l=angular.element("<a>").attr("href","/search/"+s.name).html(s.name),l.on("click",e),c=angular.element("<div>").addClass("result").append(l),i.append(c);return i.show()}):i.hide()})}})).directive("legislator",["LYService","TWLYService","$parse"].concat(function(t,e){return{restrict:"A",scope:{legislator:"=legislator",legislatorStyle:"="},templateUrl:"app/partials/legislator.jade",controller:["$scope"].concat(function(n){return n.$watch("legislator",function(r){var a,i,o,s,l;return(a=/(?:本院)?(.*黨團)/.exec(r))?(i=t.parseParty(replace$.call(a[1],/黨團$/,"")),n.name=r,n.party=i,void(n.iconClass=i)):"String"===toString$.call(r).slice(8,-1)?(o="http://avatars.io/50a65bb26e293122b0000073/"+CryptoJS.MD5("MLY/"+r).toString(),o+="?size="+(null!=(s=null!=(l=n.legislatorStyle)?l.size:void 0)?s:"small"),n.party=t.resolveParty(r),n.name=r,n.avatar=o,n.twlylink=e.getLink(r),n):import$(n,n.legislator)})})}})),angular.module("app.filters",[]).filter("interpolate",["version"].concat(function(t){return function(e){return String(e).replace(/\%VERSION\%/gm,t)}}));var TWLYMapping,replace$="".replace;TWLYMapping={"孔文吉":1312,"田秋堇":1316,"吳育昇":1322,"吳秉叡":1324,"李昆澤":1327,"林淑芬":1337,"林滄敏":1338,"林鴻池":1340,"張慶忠":1347,"費鴻泰":1365,"黃志雄":1366,"黃偉哲":1367,"管碧玲":1374,"潘孟安":1376,"蔡其昌":1377,"蔡錦隆":1380,"薛凌":1384,"謝國樑":1387,"羅淑蕾":1638,"王進士":1701,"林明溱":1706,"陳亭妃":1708,"陳節如":1709,"廖正井":1711,"鄭汝芬":1713,"盧嘉辰":1715,"簡東明":1717,"蘇震清":1718,"張嘉郡":1719,"陳淑慧":1720,"蔣乃辛":1722,"劉建國":1723,"馬文君":1724,"王廷升":1727,"王育敏":1728,"王惠美":1729,"尤美女":1730,"江啟臣":1731,"江惠貞":1732,"何欣純":1733,"吳育仁":1734,"吳宜臻":1735,"呂玉玲":1736,"李俊俋":1738,"李貴敏":1739,"林世嘉":1740,"林佳龍":1741,"林國正":1742,"邱文彥":1743,"邱志偉":1744,"姚文智":1745,"徐欣瑩":1747,"張曉風":1748,"許忠信":1749,"許智傑":1750,"陳雪生":1751,"陳碧涵":1752,"陳歐珀":1753,"陳鎮湘":1754,"曾巨威":1755,"黃文玲":1756,"楊玉欣":1757,"楊應雄":1758,"楊曜":1759,"詹凱臣":1760,"趙天麟":1761,"劉櫂豪":1762,"鄭天財Sra.Kacaw":1763,"鄭天財":1763,"鄭麗君":1764,"蘇清泉":1765,"顏寬恒":1803,"陳怡潔":1804,"葉津鈴":1805,"王金平":22,"丁守中":515,"洪秀柱":546,"翁重鈞":551,"李慶華":607,"柯建銘":629,"許添財":639,"陳唐山":645,"黃昭順":665,"潘維剛":678,"李應元":708,"林郁方":716,"徐少萍":726,"陳其邁":734,"蔡煌瑯":752,"林正二":788,"陳明文":828,"陳根德":833,"陳超明":836,"陳學聖":840,"楊瓊瓔":854,"葉宜津":855,"賴士葆":866,"盧秀燕":869,"羅明才":879,"呂學樟":892,"李桐豪":896,"李鴻鈞":898,"林岱樺":904,"林德福":908,"邱議瑩":913,"段宜康":917,"紀國棟":918,"孫大千":919,"徐耀昌":921,"高志鵬":923,"高金素梅":926,"楊麗環":960,"廖國棟":962,"蔡正元":966,"顏清標":979,"魏明谷":980,"蕭美琴":981},angular.module("app.services",[]).factory({LYService:["$http"].concat(function(t){var e;return e=[],{init:function(){return t.get("/data/mly-8.json").success(function(t){return e=t})},resolveParty:function(t){var n,r;return n=function(){var a,i,o,s,l=[];for(a=0,o=(i=e).length;o>a;++a)s=i[a],n=s.party,r=s.name,r===t&&l.push(n);return l}()[0]},resolvePartyColor:function(t){return{KMT:"#000095",DPP:"#009a00",PFP:"#fe6407"}[this.resolveParty(t)]||"#999"},parseParty:function(t){var e;return e=function(){var e;switch(e=[t],!1){case"中國國民黨"!==e[0]:return"KMT";case"國民黨"!==e[0]:return"KMT";case"民主進步黨"!==e[0]:return"DPP";case"民進黨"!==e[0]:return"DPP";case"台灣團結聯盟"!==e[0]:return"TSU";case"台灣團結聯盟"!==e[0]:return"TSU";case"無黨團結聯盟"!==e[0]:return"NSU";case"親民黨"!==e[0]:return"PFP";case"新黨"!==e[0]:return"NP";case"建國黨"!==e[0]:return"TIP";case"超黨派問政聯盟"!==e[0]:return"CPU";case"民主聯盟"!==e[0]:return"DU";case"新國家陣線"!==e[0]:return"NNA";case!/無(黨籍)?/.test(e[0]):return null;case"其他"!==e[0]:return null;default:return console.error(it)}}()}}})}).service({TWLYService:["$http"].concat(function(){var t;return t="http://vote.ly.g0v.tw/voter/",{getLink:function(e){return TWLYMapping[e]?t+TWLYMapping[e]:void 0}}})}).service({LYModel:["$q","$http","$timeout"].concat(function(t,e,n){var r,a,i,o;return r=window.global.config.APIENDPOINT+"v0/collections/",a={},i=function(e){var r,i;return r=t.defer(),i=r.promise,i.success=function(t){return i.then(t)},i.error=function(t){return i.then(t)},n(function(){return console.log("useLocalCache"),r.resolve(a[e])}),i},o=function(t,n,r){var i,o,s;return i=e.get(n,r),o=i.success,s=i.error,i.success=function(e){return o(function(n){return console.log("save response to local model"),a[t]=n,e(n)})},i.error=function(t){return s(function(e){return t(e)})},i},{get:function(t,e){var n,s;return n=r+t,s=e?n+JSON.stringify(e):n,s=replace$.call(s,/\"/g,""),a.hasOwnProperty(s)?i(s):o(s,n,e)}}})}).service({LYLaws:["$q","$http","$timeout"].concat(function(t,e){var n,r,a,i;return n=window.global.config.APIENDPOINT+"v0/collections/laws",r=[],a=function(){return e.get(n,{params:{l:1}}).success(function(t){var a,i;return a=t.paging,i=t.entries,e.get(n,{params:{l:a.count}}).success(function(t){var e,n,a,i,o,s=[];for(e=t.paging,n=t.entries,a=0,i=n.length;i>a;++a)o=n[a],s.push(r.push(o));return s})})},i=function(t){var e,n,a,i,o;for(e=[],n=0,i=(a=r).length;i>n;++n)o=a[n],o.name.match(t)&&e.length<7&&e.push(o);return e},a(),{get:function(t,e){var n;return n=i(t),e(n)}}})});var parseArticleHeading,billAmendment,makeDiff,diffmeta,slice$=[].slice,replace$="".replace;parseArticleHeading=function(t){var e,n,r,a;return null!=(e=t.match(/第(.+)之(.+)條/)||t.match(/第(.+)條(?:之(.+))?/))&&(n=e[0],r=slice$.call(e,1)),r?(a=require("zhutil"),r.filter(function(t){return t}).map(a.parseZHNumber).join("-")):void 0},billAmendment=function(t,e,n,r){return function(a){var i,o,s,l,c,u,d;return i=t.header,o="string"==typeof a[n]?a[n]:a[n][i[e].replace(/審查會通過條文/,"審查會")],o&&(o=o.replace(/\n/g,"<br><br>\n")),s=a[r]||"",s&&(s=replace$.call(s,/^第(.*?)條(之.*?)?\s+/,""),(l=parseArticleHeading(replace$.call(RegExp.lastMatch,/\s+$/,"")))&&(c=l)),u=a[e]||a[r]||"",u=replace$.call(u,/^第(.*?)條(之.*?)?\s+/,""),d=parseArticleHeading(replace$.call(RegExp.lastMatch,/\s+$/,"")),c||((u.match(/^（\S+）\n第(.*?)條/)||u.match(/^（\S+第(.*?)條，保留）/))&&(d=parseArticleHeading(replace$.call(RegExp.lastMatch,/\s+$/,""))),c=u.match(/^(（\S+）\n|)第\S+(章|編)/)?u.replace(/^（\S+）\n/,"").split("　")[0]:d||""),{comment:o,article:d,originalArticle:c,content:u,baseContent:s}}},makeDiff=function(t){return function(e){var n,r,a,i;return n=e.baseContent,r=e.content,a=e.comment,i=lineBasedDiff(n,r).map(function(e){return e.left=t.trustAsHtml(e.left||"無"),e.right=t.trustAsHtml(e.right),e}),a=t.trustAsHtml(a),import$({comment:a,difflines:i},{leftItem:"§"+e.originalArticle,leftItemAnchor:e.originalArticle,rightItem:"§"+e.article})}},diffmeta=function(t){return null!=t?t.map(function(t){var e,n,r,a,i;return t.name||(t.name="併案審議"),e=t.header,a=function(){var t,a,i,o=[];for(t=0,i=(a=e).length;i>t;++t)n=t,r=a[t],/^現行/.exec(r)&&o.push(n);return o}()[0],i=function(){var t,a,i,o=[];for(t=0,i=(a=e).length;i>t;++t)n=t,r=a[t],"說明"===r&&o.push(n);return o}()[0],import$({header:t.header,content:t.content,name:t.name},{versions:e.filter(function(t,e){return"說明"!==t&&e!==a}),baseIndex:a,commentIndex:i,diffbase:e[a],diffnew:e[0],amendment:t.content.map(billAmendment(t,0,i,a))})}):void 0},angular.module("app.controllers.bills",[]).controller({LYBills:["$scope","$state","$timeout","LYService","LYModel","$sce","$anchorScroll","TWLYService"].concat(function(t,e,n,r,a,i,o){return t.diffs=[],t.diffstate=function(t,e){switch(!1){case!("left"===t&&"equal"!==e):return"red";case!(deepEq$(e,"replace","===")||deepEq$(e,"empty","===")||deepEq$(e,"insert","===")||deepEq$(e,"delete","===")):return"green";default:return""}},t.difftxt=function(t,e){switch(!1){case!("left"===t&&"equal"!==e):return"現行";case!(deepEq$(e,"replace","===")||deepEq$(e,"empty","===")):return"修正";case!deepEq$(e,"delete","==="):return"刪除";case!deepEq$(e,"insert","==="):return"新增";default:return"相同"}},t.opts={show_date:!0},t.spies={},t.$watch("$state.params.billId",function(){var r;return r=e.params.billId,a.get("bills/"+r).success(function(s){var l,c,u,d;if(l=s.committee,e.current.title="ly.g0v.tw - "+(s.bill_ref||s.bill_id)+" - "+s.summary,c=s.bill_ref){if(c!==r&&!/;/.test(c))return e.transitionTo("bills",{billId:s.bill_ref});t.steps=buildSteps(s.motions),/-/.test(s.bill_ref)||(u=require("sprintf"),a.get("ttsmotions",{params:{s:{date:-1},q:JSON.stringify({bill_refs:{$contains:s.bill_ref}})}}).success(function(e){var n,r,i,o,l,c,d,f,p,m,g,h;for(t.ttsmotions=e.entries,n=0,i=(r=t.ttsmotions).length;i>n;++n){o=n,l=r[n],l.resolution=replace$.call(l.resolution,/\(p\.(.*)\)/,""),c=RegExp.$1.split(/(?:[\s,;]*)?(.*?)\s*(\[.*?\])/),d=[];do{if(f=c.slice(0,3),p=f[0],m=f[1],g=f[2],3!==f.length)break;g=JSON.parse(g),"g"===g[0]&&(h=u.apply(null,["%03d%03d%02d"].concat([g[1],g[2],g[3]])),g="http://lis.ly.gov.tw/lgcgi/lypdftxt?"+h+";"+g[4]+";"+g[5]),d.push({text:m,link:g})}while(c.splice(0,3));switch(l.links=d,l.progress){case"提案":case"退回程序":matchMotions(t.steps[0].detail,l);break;case"一讀":matchMotions(t.steps[1].detail,l);break;case"委員會":matchMotions(t.steps[2].detail,l);break;case"二讀":matchMotions(t.steps[3].detail,l);break;case"三讀":matchMotions(t.steps[4].detail,l);break;case"頒佈":matchMotions(t.steps[5].detail,l);break;case"生效":matchMotions(t.steps[6].detail,l)}}return a.get("bills",{params:{q:JSON.stringify({report_of:{$contains:s.bill_id}}),fo:!0}}).success(function(e){var n,r;return t.report=e,t.steps[3].date=e.motions[0].dates[0].date,n=t.steps[3].status,n.step="scheduled",r={name:"committee",description:e.summary,status:/審查決議：「不予審議」/.exec(e.summary)?{step:"red",state:"red",icon:"exclamation"}:{step:"passed",state:"passed",icon:"check"}},t.steps[2].status=r.status,t.steps[2].detail.push(r)})})),a.get("bills/"+r+"/data").success(function(e){var n,r;return t.diff=diffmeta(null!=e?e.content:void 0),t.diff.map(function(t){return t.diffcontent=t.amendment.map(makeDiff(i))}),null!=(n=t.diff)&&n.length&&(r=t.diff.map(function(t){return t.content.length}).reduce(curry$(function(t,e){return t+e}))),t.showSidebar=r>3})}return null!=l&&(l=l.map(function(t){return{abbr:t,name:committees[t]}})),(t.summary=s.summary,t.abstract=s.abstract,t.bill_id=s.bill_id,t.bill_ref=s.bill_ref,t.doc=s.doc,t.sponsors=s.sponsors,t.cosponsors=s.cosponsors,d=t,d.committee=l,d).setDiff=function(t,e){var n,r,a,o,s,l;return a=function(){var a,i,o,s=[];for(a=0,o=(i=t.header).length;o>a;++a)n=a,r=i[a],r===e&&s.push(n);return s}()[0],o=t.baseIndex,s=t.commentIndex,l=t.content.map(billAmendment(t,a,s,o)),import$(t,{diffnew:e,diffcontent:l.map(makeDiff(i))})},t.$watch("$state.params.otherBills",function(e){function n(e){return a.get("bills/"+s+"/data").success(function(n){return null==t.toCompare&&(t.toCompare={}),t.toCompare[s]=(e.diff=diffmeta(null!=n?n.content:void 0),e)})}var r,i,o,s,l=[];if(r=null!=e?e.split(","):void 0,null!=r&&r.length){for(t.bill_refs=[t.bill_ref].concat(r),i=0,o=r.length;o>i;++i)s=r[i],l.push(a.get("bills/"+s).success(n));return l}}),t.$watch("toCompare",function(e){var n,r,a,i;if(e){t.diffMatrix=n={},r=function(t,e){var r,a,i,o,s,l,c,u,d,f,p,m,g=[];for(r=0,a=e.length;a>r;++r){for(i=e[r],o=[],null==n[s=i.name]&&(n[s]={}),l=0,u=(c=i.amendment).length;u>l;++l)d=c[l],f=null!=(m=(p=n[i.name])[s=d.article||d.originalArticle])?m:p[s]={},o.push(f[t]=d);g.push(o)}return g},r(t.bill_ref,t.diff);for(a in e)i=e[a],r(a,i.diff);return console.log(n)}}),t.showSub=function(e){return angular.forEach(t.steps,function(t,n){return t.sub=e===n?!t.sub:!1})},n(function(){return o()})})})})}).directive("spy",["$location"].concat(function(){return{restrict:"A",link:function(t,e){var n,r,a,i;if(null!=t.d)return n=null!=t.$parent.d?t.diffs.$$hashKey+"-"+t.d.$$hashKey:t.d.$$hashKey,r=null!=(i=(a=t.spies)[n])?i:a[n]={},r["in"]=function(){return e.addClass("spy"),e[0].scrollIntoViewIfNeeded()},r.out=function(){return e.removeClass("spy")}}}})).directive("spyTarget",["$location"].concat(function(){return{restrct:"A",link:function(t,e){var n,r,a,i;if(null!=t.d)return n=null!=t.$parent.d?t.diffs.$$hashKey+"-"+t.d.$$hashKey:t.d.$$hashKey,r=null!=(i=(a=t.spies)[n])?i:a[n]={},r.elem=e}}})).directive("scrollSpy",["$window","$timeout"].concat(function(t,e){return{restrict:"A",controller:["$scope"].concat(function(e){return t.diff=e.diff,t.spies=e.spies}),link:function(n){var r;return r=function(){var t,e,r,a=[];n.topNavbarHeight=$(".navbar-fixed-top").height();for(t in e=n.spies)r=e[t],a.push(r.top=r.elem.offset().top-n.topNavbarHeight);return a},n.$watch("diff",function(t){var e,n,a,i,o,s,l,c,u;for(e in n=spies)a=n[e],a.destroy=!0;for(e=0,i=t.length;i>e;++e)if(o=t[e],null!=o.$$hashKey)for(spies[o.$$hashKey].destroy=!1,s=0,l=(n=o.diffcontent).length;l>s;++s)c=n[s],null!=c.$$hashKey&&(spies[c.$$hashKey+"-"+o.$$hashKey].destroy=!1);for(u in n=spies)a=n[u],a.destroy===!0&&delete spies[u];return r()}),$(t).scroll(function(){var e,r,a,i,o;e=t.scrollY,r=null;for(a in i=n.spies)o=i[a],o.out(),e>o.top&&!(o.top<(null!=r?r.top:void 0))&&(r=o);return null!=r?r["in"]():void 0
}),e(r,100)}}})),angular.module("app.controllers.calendar",[]).controller({LYCalendar:["$rootScope","$scope","$state","$http","LYService","LYModel","$sce"].concat(function(t,e,n,r,a,i){function o(t){function e(){var t;return t={start:moment(s).day(0-i),end:moment(s).day(0-i+7)},t.label=t.start.format("YYYY:  MM-DD to "+t.end.format("MM-DD")),t.name=t.start.format("YYYY-MM-DD_"+t.end.format("YYYY-MM-DD")),t}var n,r,a,i;for(r=[],a=0;t>=a;a+=7)i=a,r.push(e());return n=r}var s,l,c,u,d,f,p,m,g;return s=moment().startOf("day"),l=t.committees,e.type="sitting",t.activeTab="calendar",e.weeksOpts=o(49),e.weeksOpts.unshift({start:moment(s).startOf("day").add("days",-1),end:moment(s).startOf("day").add("days",1),label:"今日",name:"today"}),e.$watch("weeks",function(t,r){return e.weeks?t&&r&&!deepEq$(t.label,r.label,"===")?n.transitionTo("calendar.period",{period:e.weeks.name}):void 0:void 0}),e.change=function(t){e.type=t,c()},e.$watch("$state.params.period",function(){return n.params.period?c():void n.transitionTo("calendar.period",{period:e.weeksOpts[0].name})}),c=function(){var t,r,a,i,o,s;return d(n.params.period),t=/^calendar.period/.exec(n.current.name)?d(n.params.period):void 0,r=t[0],a=t[1],i=t[2],(!r.isValid()||!a.isValid()||r>a)&&(t=[e.weeksOpts[0].start,e.weeksOpts[0].end,"today"],r=t[0],a=t[1],i=t[2]),t=[r,a].map(function(t){return t.format("YYYY-MM-DD")}),o=t[0],s=t[1],null==i&&(i=o+"_"+s),deepEq$(n.current.name,i,"===")||n.transitionTo("calendar.period",{period:i}),g(e.type,o,s),u(r,a)},u=function(t,n){var r,a;return a=function(){var a,i,o,s=[];for(a=0,o=(i=e.weeksOpts).length;o>a;++a)r=i[a],+r.start===+t&&+r.end===+n&&s.push(r);return s}()[0],e.weeks=a},d=function(t){var n;return/today/.exec(t)||!t?[e.weeksOpts[0].start,e.weeksOpts[0].end,e.weeksOpts[0].name]:(n=t.split("_").map(function(t){return moment(t,"YYYY-MM-DD")}),n.push(t),n)},f=function(t,e){var n;return n=e.date+e.time_start+e.time_end+e.sitting_id,null==t[n]&&(t[n]=e),t[n]=e.id>t[n].id?e:t[n]},p=function(t){var e,n,r,a,i,o;for(e=Object.keys(t).sort(),r=[],a=0,i=e.length;i>a;++a)o=e[a],t[o]&&r.push(t[o]);return n=r},m=function(t,e,n){var r,a,i,o;return r=moment(t).startOf("day"),a=[e,n].map(function(t){return moment(t,"HH:mm:ss")}),i=a[0],o=a[1],+s===+r&&i<=(a=moment())&&o>=a},g=function(t,n,r){return i.get("calendar",{params:{s:JSON.stringify({date:1,time_start:1}),q:JSON.stringify({date:{$gt:n,$lt:r},type:t}),l:1e3}}).success(function(t){var n,r,a,i,o;n=t.paging,r=t.entries,a={},r.map(function(t){var e,n;return t.formatDate=moment(t.date).zone("+00:00").format("MMM Do, YYYY"),t.primaryCommittee=(null!=(e=t.committee)?e[0]:void 0)||"YS",t.onair=m(t.date,t.time_start,t.time_end),null==a[n=t.primaryCommittee]&&(a[n]={}),f(a[t.primaryCommittee],t)}),i={};for(o in a)r=a[o],i[o]=p(a[o]);return e.group=i,e.groupNum=Object.keys(e.group).length})}})}),function(){var t={};t.exports={BUILD:"git-89246f7",APIENDPOINT:"http://api.ly.g0v.tw/"},window.global||(window.global={}),window.global.config=t.exports}.call(this),angular.module("ly.g0v.tw.controllers",["ng"]).controller({LYDebates:["$rootScope","$scope","$http","LYService","$sce","LYModel"].concat(function(t,e,n,r,a,i){var o;return t.activeTab="debates",e.answer=function(t){switch(!1){case!t:return a.trustAsHtml("已答");default:return a.trustAsHtml("未答")}},o=function(t,e){return t.length>=e?t:o("0"+t,e)},e.source=function(t){var e,n,r,i,s;return e=t.entity,n=e.source,(r=n[0].link)?(i=r[1].toString().concat(o(r[2],3)).concat(o(r[3],2)),s="http://lis.ly.gov.tw/lgcgi/lypdftxt?"+i+";".concat(o(r[4],4)).concat(";"+o(r[5],4)),a.trustAsHtml('<a href="'+s+'" target="_blank">質詢公報</a>')):""},e.answers=function(t){var e,n,r;return e=t.entity,n=e.answers,r="",angular.forEach(n,function(t){var e,n,a;t.source[0].text.match(/口頭答復/)||(e=t.source[0].link,n=e[1].toString().concat(o(e[2],3)).concat(o(e[3],2)),a="http://lis.ly.gov.tw/lgcgi/lypdftxt?"+n+";".concat(o(e[4],4)).concat(";"+o(e[5],4)),r+='<div><a href="'+a+'" target="_blank">書面答復</a></div>')}),deepEq$(r,"","===")&&(r+="口頭(見質詢公報)"),a.trustAsHtml(r)},e.pagingOptions={pageSizes:[10,20,30],pageSize:30,currentPage:1},e.$watch("pagingOptions",function(t,n){deepEq$(t.pageSize,n.pageSize,"===")&&deepEq$(t.currentPage,n.currentPage,"===")||e.getData(t)},!0),e.gridOptions=import$({showFilter:!0,showColumnMenu:!0,showGroupPanel:!0,enableHighlighting:!0,enableRowSelection:!0,enablePaging:!0,showFooter:!0},{rowHeight:90,data:"debates",pagingOptions:e.pagingOptions,i18n:"zh-tw",columnDefs:[{field:"tts_id",displayName:"系統號",width:80},{field:"asked_by",displayName:"質詢人",width:130,cellTemplate:'<div class="item" legislator="asked_by" ng-repeat="asked_by in row.entity.asked_by"></div>'},{field:"source",displayName:"質詢公報",width:80,cellTemplate:'<div ng-bind-html="source(row)"></div>'},{field:"answers",displayName:"答復公報",width:100,cellTemplate:'<div ng-bind-html="answers(row)"></div>'},{field:"summary",displayName:"案由",visible:!1},{field:"answered",displayName:"答復",width:"50",cellTemplate:'<div ng-bind-html="answer(row)"></div>'},{field:"date_asked",cellFilter:"date: mediumDate",width:"100",displayName:"質詢日期"},{field:"category",width:"*",displayName:"類別",cellTemplate:'<div ng-repeat="c in row.getProperty(col.field) track by $id($index)"><span class="label">{{c}}</span></div>'},{field:"topic",displayName:"主題",width:"*",cellTemplate:'<div ng-repeat="c in row.getProperty(col.field) track by $id($index)"><span class="label">{{c}}</span></div>'},{field:"keywords",displayName:"關鍵詞",width:"*",cellTemplate:'<div ng-repeat="c in row.getProperty(col.field) track by $id($index)"><span class="label">{{c}}</span></div>'},{field:"answered_by",displayName:"答復人",width:"80",cellTemplate:'<div ng-repeat="c in row.getProperty(col.field) track by $id($index)"><span >{{c}}</span></div>'},{field:"interpellation_type",displayName:"質詢性質",width:"*"}]}),e.getData=function(t){var n,r;return n=t.currentPage,r=t.pageSize,i.get("ttsinterpellation",{params:{sk:(n-1)*r,l:r}}).success(function(t){var n,r;return n=t.paging,r=t.entries,angular.forEach(r,function(t){t.date_asked=new Date(t.date_asked),t.source=t.source}),e.debates=r})},e.getData(e.pagingOptions)})});var maketree;maketree=function(t,e,n){var r,a,i,o,s,l,c,u,d,f;return r={top:0,right:40,bottom:0,left:40},a=960-r.right,i=n-r.top-r.bottom,o=d3.layout.tree().size([i,1]).separation(function(){return 1}),o.sort(function(t,e){return+t.name-+e.name}),s=d3.select(t).append("svg").attr("width",a+r.left+r.right).attr("height",i+r.top+r.bottom).style("margin","1em 0 1em "+-r.left+"px"),l=s.append("g").attr("transform","translate("+r.left+","+r.top+")"),c=o.nodes(e),u=d3.scale.linear().range([0,a]),u.domain([d3.min(c,function(t){return+t.name}),d3.max(c,function(t){return+t.name})]),d=l.selectAll(".link").data(o.links(c)).enter().append("path").attr("class","link").attr("d",d3.svg.diagonal().source(function(t){return{y:u(+t.source.name),x:t.source.x}}).target(function(t){return{y:u(+t.target.name),x:t.target.x}}).projection(function(t){return[t.y,t.x]})),f=l.selectAll(".node").data(c).enter().append("g").attr("class",function(t){return(t.type||"")+" node"}).attr("transform",function(t){return"translate("+u(+t.name)+","+t.x+")"}),f.append("text").attr("x",6).attr("dy",".32em").text(function(t){return t.name}).each(function(t){return t.width=this.getComputedTextLength()+12}),f.insert("rect","text").attr("ry",6).attr("rx",6).attr("y",-10).attr("height",20).attr("width",function(t){return Math.max(32,t.width)}),s},window.billHistory=function(t){var e,n,r,a,i,o,s,l,c,u,d;return e={top:20,right:20,bottom:100,left:40},n=960-e.left-e.right,r=500-e.top-e.bottom,a=d3.scale.ordinal().rangeRoundBands([0,n],.1),i=d3.scale.linear().rangeRound([r,0]),o=t.map(function(t){return t.motions.map(function(t){return t.meeting})}).reduce(curry$(function(t,e){return t.concat(e)})),s=d3.min(o),l=d3.max(o),a.domain(t.map(function(t){return t.motions.map(function(t){return t.meeting})}).reduce(curry$(function(t,e){return t.concat(e)}))),c=d3.svg.axis().scale(a).orient("bottom"),u=function(t,e,n){var r,a,i,o,s,l,c,d,f,p,m,g=[];if(a=function(){var t,a,i,o=[];for(t=0,i=(a=e).length;i>t;++t)r=a[t],r.id===n&&o.push(r);return o}()[0],null!=a){for(i=t,o=0,l=(s=a.motions).length;l>o;++o)c=s[o],d={name:c.meeting,bill:a,"class":"motion",children:[],type:"text"},console.log("push",i,d),i.children.push(d),i=d;for(o=0,l=(s=null!=(f=a.related)?f:[]).length;l>o;++o)p=s[o],g.push(m=u(i,e,p));return g}},d={name:17,"class":"root",children:[]},u(d,t,t[0].id),u(d,t,t[0].id),console.log(d),maketree(".history",d,360)};var stackedBars;window.loadMotions=function(t){return $(function(){return d3.json("/data/8-2.json",function(e){var n;return n=e.map(function(t){var e,n,r,a,i,o,s,l,c,u,d,f;for(e=t.meeting,n=t.announcement,r=t.discussion,a=function(){return d3.nest().key(function(t){var e;return null!=(e=t.status)?e:"unknown"}).rollup(function(t){return t.length})},o=[],s=0,l=r.length;l>s;++s)c=r[s],"exmotion"===c.type&&o.push(c);for(i=o,o=[],s=0,l=r.length;l>s;++s)c=r[s],"exmotion"!==c.type&&o.push(c);return r=o,u=a().map(n),d=a().map(r),f=a().map(i),{sitting:e.sitting,ann:n.length,dis:null!=r?r.length:void 0,ann_status:u,dis_status:d,exm_status:f,announcement:n,discussion:r,exmotion:i,meeting:e}}),t.$root.$broadcast("data",n),stackedBars(n,t)})})},stackedBars=function(t,e){var n,r,a,i,o,s,l,c,u,d,f,p,m,g,h,v,y,w,b,$,k;return n={top:10,right:20,bottom:10,left:60},r=1600,a=600,i=d3.scale.ordinal().rangeRoundBands([0,r],.1),o=d3.scale.linear().rangeRound([a,0]),s=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),l=d3.svg.axis().scale(i).orient("bottom"),c=d3.svg.axis().scale(o).orient("left").tickFormat(d3.format(".2s")),u=r+n.left+n.right,d=a+n.top+n.bottom,f="0 0 "+u+" "+d,p=d3.select(".chart").append("svg").attr("width","100%").attr("height","80%").attr("viewBox",f).append("g").attr("transform","translate("+n.left+","+n.top+")"),m=200,g=800,h=d3.select(".legends").append("svg").attr("width","100%").attr("height","80%").attr("viewbox","0 0 "+m+" "+g),v=d3.scale.ordinal().range(["#cccccc","#8a89a6","#7b6888","#6b486b","#ff8c00","#ff1c00","#000000","#23ff8c","#6b486b","#dddddd","#dddddd"]).domain(["retrected","rejected","accepted","committee","prioritized","unhandled","consultation","passed","ey","other","unknown"]),s.domain(["ann","dis"]),t.forEach(function(t){var e,n;return e=0,t.cum=s.domain().map(function(n){return{name:n,y0:e,y1:e+=+t[n]}}),e=0,t.ann_cum=v.domain().map(function(n){var r;return{name:n,y0:e,y1:e+=+(null!=(r=t.ann_status[n])?r:0)}}),e=0,t.dis_cum=v.domain().map(function(n){var r;return{name:n,y0:e,y1:e+=+(null!=(r=t.dis_status[n])?r:0)}}),e=0,t.exm_cum=v.domain().map(function(n){var r;return{name:n,y0:e,y1:e+=+(null!=(r=t.exm_status[n])?r:0)}}),t.total=(n=t.cum)[n.length-1].y1}),i.domain(t.map(function(t){return t.sitting})),o.domain([0,d3.max(t,function(t){return t.total})]),y=function(t,n,r){return e.$root.$broadcast("show",r,t,n)},p.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(l),w=p.selectAll(".sitting").data(t).enter().append("g").attr("class","g").attr("transform",function(t){return"translate("+i(t.sitting)+",0)"}).on("click",function(t){return y("announcement",t.name,$)}),b=p.append("g").selectAll(".desc").data(["報告事項","討論事項","臨時提案"]).enter().append("text").attr("class","desc").attr("transform",function(t,e){return"rotate(-90)translate("+(-a-10)+","+(i.rangeBand()*e/3+i(5))+")"}).attr("dy",".71em").style("text-anchor","end").text(function(t){return t}),$=null,w.selectAll("rect.sep").data(function(t){return[t.sitting]}).enter().append("rect").attr("class","sep").attr("width",1).attr("y",0).attr("x",i.rangeBand()+3).attr("height",a).style("fill","none").style("stroke","black").style("stroke-width",1).style("opacity",.2),w.selectAll("rect.col").data(function(t){return[t.sitting]}).enter().append("rect").attr("class","col").attr("width",i.rangeBand()).attr("y",0).attr("height",a).style("fill","white").style("opacity",0).on("mouseover",function(t){return t!==$?(b.attr("transform",function(e,n){return"rotate(-90)translate("+(-a-20)+","+(i.rangeBand()*n/3+i(t))+")"}),$=t):void 0}),w.selectAll("rect.ann").data(function(t){return t.ann_cum}).enter().append("rect").attr("class","ann").attr("width",i.rangeBand()/3-2).attr("y",function(t){return o(t.y1)}).attr("height",function(t){return o(t.y0)-o(t.y1)}).style("fill",function(t){return v(t.name)}),w.selectAll("rect.dis").data(function(t){return t.dis_cum}).enter().append("rect").attr("class","dis").attr("width",i.rangeBand()/3-2).attr("x",function(){return i.rangeBand()/3+1}).attr("y",function(t){return o(t.y1)}).attr("height",function(t){return o(t.y0)-o(t.y1)}).style("fill",function(t){return v(t.name)}),w.selectAll("rect.exm").data(function(t){return t.exm_cum}).enter().append("rect").attr("class","exm").attr("width",i.rangeBand()/3-2).attr("x",function(){return i.rangeBand()/3*2+1}).attr("y",function(t){return o(t.y1)}).attr("height",function(t){return o(t.y0)-o(t.y1)}).style("fill",function(t){return v(t.name)}),k=h.selectAll(".legend").data(v.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"}),k.append("rect").attr("x",0).attr("width",18).attr("height",18).style("fill",v),k.append("text").attr("x",20).attr("y",9).attr("dy",".35em").text(function(t){return e.statusName(t)}),p.append("g").attr("class","y axis").call(c).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("議案數")},angular.module("utils",[]).controller("topBtnCtrl",["$scope","$window"].concat(function(t,e){return t.showBtn=!1,angular.element(e).bind("scroll",function(){return console.log(window.pageYOffset),t.showBtn=window.pageYOffset>500?!0:!1,t.$apply()}),t.jumpToTop=function(){return window.scrollTo(0,0)}})),angular.module("app.controllers.search",[]).controller({LYSearch:["$rootScope","$scope","$state","$timeout","LYModel"].concat(function(t,e,n,r,a){var i;return e.limit=12,e.sk=0,e.results=[],e.$watch("$state.params.keyword",function(){return e.sk=0,e.keyword=n.params.keyword,n.params.keyword?a.get("laws",{params:{q:JSON.stringify({name:{$matches:n.params.keyword}}),f:JSON.stringify({id:1}),fo:!0}}).success(function(t){var n;return n=t.id,e.lawId=n,e.results=[],e.moreResults()}):void 0}),e.moreResults=function(){return e.busy=!0,i(e.lawId,function(t){function n(t){return e.results.push(t)}var r,i,o;for(r=0,i=t.length;i>r;++r)o=t[r],a.get("bills/"+o.bill_ref).success(n);return 0===t.length&&(e.stopDetect=!0),e.busy=!1})},i=function(t,n){return a.get("amendments",{params:{q:JSON.stringify({law_id:t}),f:JSON.stringify({bill_ref:1}),l:e.limit,sk:e.sk}}).success(function(t){var r,a;return r=t.paging,a=t.entries,e.sk+=e.limit,n(a)})}})});var names_to_avatars,keys,uniq,split$="".split,join$=[].join;names_to_avatars=function(t){var e,n,r,a=[];for(e=0,n=t.length;n>e;++e)r=t[e],a.push(CryptoJS.MD5("MLY/"+r).toString());return a},keys=function(t){var e,n,r=[];for(e in t)n=t[e],r.push(e);return r},uniq=function(t){var e;return keys(function(){var n,r,a,i={};for(n=0,a=(r=t).length;a>n;++n)e=r[n],i[e]=1;return i}())},angular.module("app.controllers.sittings-new",[]).controller({LYSittingsNew:["$scope","$rootScope","$state","$timeout","LYService","LYModel","$sce","$anchorScroll"].concat(function(t,e,n,r,a,i){return t.adv_mode=!1,t.$watch("$state.params.sittingId",function(){return i.get("sittings/"+n.params.sittingId+"/motions").success(function(r){function a(r){var a,i,s,l,c,u,d,f,p,m,g,h,v,y;for(a=r.motions,i=r.sponsors,s=r.cosponsors,l=r.bill_id,i||(i=[]),s||(s=[]),c=[],u=0,d=a.length;d>u;++u)f=a[u],f.sitting_id===n.params.sittingId&&c.push(f);if(a=c,1===a.length){if(p=[],null!=(m=a[0].committee)&&m.length)for(u=0,d=(m=a[0].committee).length;d>u;++u)g=m[u],p.push(e.committees[g]+"委員會");p||(p=["院會"]),h=uniq(function(){var t,e,n,r=[];for(t=0,n=(e=a[0].dates).length;n>t;++t)v=e[t],r.push(v.date);return r}()),h.sort(),v=new Date(split$.call(h[h.length-1],"-")),y=v.getMonth()+"/"+v.getDate()}else console.warning("Unexpected motions.length",a),p=[];return m=t.motions[o[l]],m.category="修法",m.bill_id=l,m.date=y,m.sponsors=i||[],m.cosponsors=s||[],m.show=!0,m.committees=join$.call(p,","),m.sponsor_avatars=names_to_avatars(i),m.cosponsor_avatars=names_to_avatars(s),m}var o,s,l,c,u,d,f,p,m=[];for(o={},s=0,l=r.length;l>s;++s)c=s,u=r[s].bill_id,o[u]=c;for(t.motions=r,s=0,l=r.length;l>s;++s)d=r[s],u=d.bill_id,f=d.sitting_introduced,m.push(f?i.get("bills/"+u).success(a):p=null);return m})})})});var replace$="".replace;angular.module("app.controllers.sittings",[]).controller({LYSittings:["$rootScope","$scope","$http","$state","LYService","LYModel","$location"].concat(function(t,e,n,r,a,i,o){var s,l,c,u,d;return t.activeTab="sittings",s=t.committees,e.lists={},window.YT?e.youtubeReady=!0:e.$on("youtube-ready",function(){return e.youtubeReady=!0}),e.setContext=function(t){return e.context=t,r.params.sitting=null},e.$watch("$state.params.sitting",function(){var t;return(t=r.params.sitting)?(e.sitting_id=t,console.log("specified sitting, get context from id of sitting"),e.context=replace$.call(t,/[\d-]/g,""),c(t)):(console.log("no specified sitting, use YS as default context if necessary"),e.context||(e.context="YS"))}),e.$watch("context",function(t,n){return t||n?(console.log("current context is ",e.context),e.lists.hasOwnProperty(e.context)?e.currentList=e.lists[e.context]:(console.log("using context that we do not have yet. fetch it "),l())):void 0}),e.$watchCollection("[absolutePlayerTime, shareOffset, dateOffset, timeOffset]",function(){var t;return t=e.shareOffset?(e.dateOffset=e.absolutePlayerTime.format("YYYY-MM-DD"),e.timeOffset=e.absolutePlayerTime.format("HH:mm:ss"),"#"+e.dateOffset+"T"+e.timeOffset):"",e.sharelink=replace$.call(o.absUrl(),/#.*$/,"")+t,e.sharelinkEscaped=replace$.call(o.absUrl(),/#.*$/,"")+escape(t)}),l=function(t){var n;return n=s[e.context]?'{"'+e.context+'"}':null,t||(t=40),e.loadingList=!0,i.get("sittings",{params:{q:{ad:8,committee:n},l:t,f:{motions:!1,videos:!1}}}).success(function(t){var n;return n=t.entries,e.loadingList=!1,e.lists[e.context]=n,e.currentList=e.lists[e.context]})},e.$watch("currentList",function(){var t,n,a,i,o;if(e.currentList)return t=null!=(n=function(){var t,n,o,s=[];for(t=0,o=(n=e.currentList).length;o>t;++t)a=n[t],i=a.id,i===r.params.sitting&&s.push(a);return s}())?n[0]:void 0,t?e.chosenSitting=t:(o=r.params.sitting,o?(console.log("user specified a id out of fetched list, use the i and keep drop-down list blank"),c(o)):(console.log("user move to a new context, use the lastest sitting by default"),e.chosenSitting=e.currentList[0]))}),e.$watch("chosenSitting",function(t){var n;if(t)return n=e.chosenSitting.id,c(e.chosenSitting.id)}),c=function(t){var n;return n=/^sittings.detail/.exec(r.current.name)?r.current.name:"sittings.detail",r.transitionTo(n,{sitting:t}),e.loadingSitting=!0,i.get("sittings/"+t).success(function(n){return e.loadingSitting=!1,import$(e,n),e.data=[],e.data.announcement=u(n.motions,"announcement"),e.data.discussion=u(n.motions,"discussion"),e.data.exmotion=u(n.motions,"exmotion"),e.setType("announcement"),i.get("sittings/"+t+"/videos").success(function(t){return e.videos=t})})},u=function(t,e){var n;return function(){var r,a,i,o=[];for(r=0,i=(a=t).length;i>r;++r)n=a[r],n.motion_class===e&&o.push(n);return o}()},import$(e,{allTypes:[{key:"announcement",value:"報告事項"},{key:"discussion",value:"討論事項"},{key:"exmotion",value:"臨時提案"}],setType:function(t){var n,r,i,o,s,l,c,u,d;for(n=e.data[t],r=[{key:"all",value:"全部"}].concat(function(){function t(){var t,e,r,a,i={};for(t=0,r=(e=n).length;r>t;++t)o=e[t],i[null!=(a=o.status)?a:"unknown"]=!0;return i}var r=[];for(i in t())r.push({key:i,value:e.statusName(i)});return r}()),in$(e.status,r.map(function(t){return t.key}))||(e.status=""),s=0,l=n.length;l>s;++s)if(o=n[s],null==o.avatars)switch(c=[o.proposed_by],!1){case!(u=/委員(.*?)(、|等)/.exec(c[0])):o.avatars=[u[1]];break;case!(u=/本院(.*黨團)/.exec(c[0])):d=a.parseParty(replace$.call(u[1],/黨團$/,"")),o.avatars=[{party:d,name:u[1],iconClass:d}]}return e.type=t,e.entries=n,e.allStatus=r,e},setStatus:function(t){return"all"===t&&(t=""),"unknown"===t&&(t=""),e.status=t},statusName:function(t){var e,n;return e={unknown:"未知",other:"其他",passed:"通過",consultation:"協商",retrected:"撤回",unhandled:"未處理",ey:"請行政院研處",prioritized:"逕付二讀",committee:"交委員會",rejected:"退回",accepted:"查照"},null!=(n=e[t])?n:t}}),e.playFrom=function(t){return-1===e.player.getPlayerState()?(e.player.playVideo(),e.player.nextStart=t):e.player.seekTo(t)},e.$watch("$state.current.name + $state.params.sitting",function(){var t;if("sittings.detail.video"===r.current.name){if(e.video=!0,e.loaded===r.params.sitting)return;return e.loaded=r.params.sitting,d=e.$watch("$location.hash()",function(e){return e?t=moment(e+"+08:00"):void 0}),getVideosByCut(i,r.params.sitting,function(r){var a,i,o,s,l,c,u,d,f;if(t)for(a=0,i=r.length;i>a;++a)o=r[a],o.first_frame<=t&&t<=o.first_frame+1e3*o.length&&(e.currentVideo=o);return null==e.currentVideo&&(e.currentVideo=r[0]),s=!1,l=function(n){var r;return e.player=n.target,t?(r=e.currentVideo.first_frame,e.player.nextStart=(t-r)/1e3,e.player.playVideo(),t=null,$("#player").get(0).scrollIntoView()):void 0},c=null,u=function(t){var n,r,a,i;t.data!==YT.PlayerState.PLAYING||s?(c&&clearInterval(c),c=null):((n=e.player.nextStart)&&(setTimeout(function(){return e.player.seekTo(n)},50),e.player.nextStart=null),c&&clearInterval(c),r=a={},r.current=1e3*e.player.getCurrentTime(),r.start=(new Date).getTime(),r.rate=e.player.getPlaybackRate(),r.now=0,i=function(){return a.now=(new Date).getTime(),e.$apply(function(){var t,n,r,i,o,s=[];for(t=0,r=(n=e.waveforms).length;r>t;++t)i=n[t],i.id===e.currentId&&(o=a.current+(a.now-a.start)*a.rate,i.current=o/1e3,s.push(e.absolutePlayerTime=moment(e.currentVideo.first_frame+o)));return s})},c=setInterval(function(){return i()},1e4),i())},e.player?e.player.loadVideoById({videoId:e.currentVideo.youtube_id}):(d=function(){var n,r;return t&&(n=e.currentVideo.first_frame,r=(t-n)/1e3),new YT.Player("player",{height:"390",width:"640",videoId:e.currentVideo.youtube_id,playerVars:{rel:0,start:null!=r?r:0,modestbranding:1},events:{onReady:l,onStateChange:u}})},e.youtubeReady?d():e.$on("youtube-ready",function(){return d()})),e.waveforms=[],e.currentId=e.currentVideo.youtube_id,f=function(n,a,i,o,s){var l,c,u,d,f;for(l=[],c=0,u=n.length;u>c;++c)d=c,f=n[c],n[d]=f/255;return e.waveforms[s]={index:s,id:r[s].youtube_id,wave:n,speakers:a,current:0,start:i,time:o,cb:function(n){var a,i;return e.currentId!==this.id&&(e.currentWaveform=this,e.player.loadVideoById(this.id),t=null,e.currentId=this.id,e.currentVideo=function(){var t,e,n,i=[];for(t=0,n=(e=r).length;n>t;++t)a=e[t],a.youtube_id===this.id&&i.push(a);return i}.call(this)[0]),null!=(i=e.player)&&(i.nextStart=n),e.playFrom(n)}}},r.forEach(function(t,e){n.get("http://kcwu.csie.org/~kcwu/tmp/ivod/waveform/"+t.wmvid+".json").error(function(){return f([],t.speakers,t.first_frame,t.time,e)}).success(function(n){return f(n,t.speakers,t.first_frame,t.time,e)})})})}return e.loaded=null,e.video=null,"function"==typeof d?d():void 0})})});var makeLine,notRight,notLeft,lineBasedDiff,charBasedDiffToDiffline,split$="".split;makeLine=function(){return{text:"",associate:-1}},notRight=function(t){return"right"!==t},notLeft=function(t){return"left"!==t},lineBasedDiff=function(t,e){var n,r,a,i,o,s;for(n=new diff_match_patch,n.Diff_Timeout=1,n.Diff_EditCost=4,r=n.diff_main(t,e),n.diff_cleanupSemantic(r),a=charBasedDiffToDiffline(r),i=0,o=a.length;o>i;++i)s=a[i],s.state=""===s.left&&""!==s.right?"insert":""!==s.left&&""===s.right?"delete":""!==s.left&&""!==s.right?s.left===s.right?"equal":"replace":"empty";return a},charBasedDiffToDiffline=function(t){function e(){switch(s){case 0:return"both";case 1:return"right";case-1:return"left"}}var n,r,a,i,o,s,l,c,u,d,f,p,m,g,h,v,y;for(n=[makeLine()],r=[makeLine()],a=0,i=t.length;i>a;++a)for(o=t[a],s=o[0],l=o[1],s=e(),c=split$.call(l,"\n"),u=0,d=c.length;d>u;++u)f=u,p=c[u],""!==p&&("both"!==s&&(p="<em>"+p+"</em>"),"both"===s&&(n[n.length-1].associate<0&&(n[n.length-1].associate=r.length-1),r[r.length-1].associate<0&&(r[r.length-1].associate=n.length-1))),notRight(s)&&(n[n.length-1].text+=p,f!==c.length-1&&n.push(makeLine())),notLeft(s)&&(r[r.length-1].text+=p,f!==c.length-1&&r.push(makeLine()));for(m=function(t,e,n){var r,a,i,o,s,l,c,u=[];for(r=0,a=0,i=t.length;i>a;++a){for(o=a,s=t[a],l=s.text,c=s.associate;c>r;)n[r][e]="",r++;null==n[r]&&(n[r]={}),n[r][e]=l,u.push(r++)}return u},g=(o=n.length)>(h=r.length)?o:h,y=[],a=1;g>=a;++a)f=a,y.push({});return v=y,m(r,"right",v),m(n,"left",v),v},"undefined"!=typeof module&&null!==module&&(module.exports={charBasedDiffToDiffline:charBasedDiffToDiffline});